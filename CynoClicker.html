<!DOCTYPE html>

<style>
    #hidden {
        visibility: hidden;
    }

    body {
        background-color: lightpink;
        font-size: 25px;
        text-align: center;
    }

    .upgradeButton {
        text-align: left;
    }

    .blah {
        object-position: bottom;
        text-align: left;
    }

</style>

<body onload="runFunc()"> </body>


<h1>You have <span id="myText"></span> Mora!</h1>
<h2>You are currently making <span id="myUpgradeText"></span> Mora per click</h2>

<button class="upgradeButton" onclick="upgrade1()">Upgrade! Costs <span id="upgradeCost"></span></button>
<br>
<img class="pic" onclick="doThing()" src="assets/CynoNoBack.png">
<br>
<audio id="audio" src="assets/Music.mp3"></audio>
<h1> <span id="upgradeText"></span></h1>

<br>

<img class="playAudioClass" onclick="playAudio()" src="assets/audioSymbol.png" width="80" height="60">

<button id="saveArray1" onclick="createSaveKey()"><span>Export</span></button>
<button id="importArray" onclick="importSaveKey()"><span>Import</span></button>

<input type="text" id="saveKey" placeholder="Type save key here..." name="saveKeyInput">
<br>

<script>
    let x = 0
    let i = 1
    let cost = 10
    //let audioOn = false

    //The function used to update all values displayed in text (for example, x, i and cost)
    function updateValues() {
        document.querySelector('#myText').textContent = x
        document.querySelector('#myUpgradeText').textContent = i
        document.querySelector("#upgradeCost").textContent = cost
    }
    //When the 'Export' button is pressed, this is activated and takes all values needed and puts them into hexedecimal and in an array
    function createSaveKey() {
        let saveArray = []
        saveArray[0] = x.toString(16)
        saveArray[1] = i.toString(16)
        saveArray[2] = cost.toString(16)


        navigator.clipboard.writeText(saveArray)
        alert("Copied the text: " + saveArray)
    }

    // Takes the array exported from the function 'createSaveKey' and interprets the data back into the game to import the save data
    function importSaveKey() {
        saveArray = document.getElementById("saveKey").value
        console.log(saveArray)
        saveArray = saveArray.split(',')

        if( saveArray[0] > 0 ||  saveArray[1] >= 1 ||  saveArray[2] >= 10) {
            x = parseInt(saveArray[0], 16)
            i = parseInt(saveArray[1], 16)
            cost = parseInt(saveArray[2], 16)
        }
        updateValues()


    }

    //Plays the audio from a certain element
    function playAudio() {
        var audio = document.getElementById("audio");
        audio.play();
    }

    //Runs upon the starting of the webpage to ensure values are shown instead of blank space whilst the variables are null
    function runFunc() {
        document.querySelector('#myText').textContent = 0
        document.querySelector('#myUpgradeText').textContent = 1
        document.querySelector("#upgradeCost").textContent = 10
    }

    // Function called when the first upgrade button is pressed
    function upgrade1() {
        if (x >= cost) {
            i ++
            x = x - cost
            cost = Math.round(cost * 2.2)

            updateValues()
        }
        else {
            document.querySelector('#upgradeText').textContent = "Purchase failed! Make sure you have sufficient funds"

            sleep(1000).then(() => {document.querySelector('#upgradeText').textContent = " ";})
            
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms))
}
        
    }
    //Funciton activated when Cyno icon is clicked
    function doThing() {
        x = x + i
        document.querySelector('#myText').textContent = x
    }
</script>